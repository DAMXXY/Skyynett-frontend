<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - SKYYNETT</title>
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="all.min.css">
  <link rel="stylesheet" href="fontawesome.min.css">
  <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="skyynettlogo.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont/dist/tabler-icons.min.css">
</head>
<body>

<!-- ===================== NAVBAR ===================== -->
<header class="navbar">
  <!-- Hamburger Menu (Mobile) -->
  <div class="hamburger" id="hamburger">
    <div class="bar top"></div>
    <div class="bar middle"></div>
    <div class="bar bottom"></div>
  </div>

  <!-- Logo Section -->
  <div class="logo">
    <img src="skyynettlogo.png" alt="Logo">
    <span class="brand-text">Skyynett</span>
  </div>

  <!-- Navigation Links -->
  <ul class="nav-links desktop-only">
    <li><a href="index.html">Home</a></li>
    <li><a href="shop.html">Shop</a></li>
    <li><a href="categories.html">Categories</a></li>
    <li><a href="#">Contact</a></li>
  </ul>

  <!-- Navbar Buttons -->
  <div class="nav-buttons">
    <!-- Search Icon -->
    <div class="search-container desktop-only">
      <button id="searchToggle" class="search-icon" aria-label="Open search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-search"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /></svg></button>
      <div id="searchDropdown" class="search-dropdown">
        <input type="text" id="searchInput" placeholder="Search products..." />
        <button id="searchBtn" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 21l-6 -6" /><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /></svg></button>
      </div>
    </div>

    <!-- Cart -->
    <button id="cartBtn" class="cart-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-shopping-cart"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M17 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M17 17h-11v-14h-2" /><path d="M6 5l14 1l-1 7h-13" /></svg>
      <span id="cartCount" class="cart-badge" style="display: none;">0</span>
    </button>

    <!-- Wishlist -->
    <button class="wishlist_nav_btn" aria-label="Wishlist"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-heart"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572" /></svg></button>

    <!-- Theme Toggle Button -->
   <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
      <!-- Sun (visible in light theme) -->
      <svg class="theme-icon sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="4"/><path d="M3 12h1m16 0h1M12 3v1m0 16v1M5 5l.7 .7m12.6 12.6l.7 .7M18.36 5.64l-.7 .7M6.34 18.36l-.7 .7"/></svg>
      <!-- Moon (visible in dark theme) -->
      <svg class="theme-icon moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"/></svg>
    </button>

    </div>

</header>

<!-- Sidebar for Mobile -->
<aside class="sidebar" id="sidebar">
  <ul class="sidebar-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="shop.html">Shop</a></li>
    <li><a href="categories.html">Categories</a></li>
    <li><a href="#">Contact</a></li>
  </ul>
  <div class="sidebar-bottom">
    <button id="wishlist_mobilenav_btn">Wishlist</button>
  </div>
</aside>


<!-- ===================== CART SIDEBAR ===================== -->
<div class="cart-sidebar" id="cartSidebar">
    <button class="close-cart" id="closeCart">&times;</button>
    <h2>Your Cart</h2>
    <ul id="cartItems"></ul>
    <div class="cart-footer">
        <p>Total: $<span id="cartTotal">0.00</span></p>
        <a href="checkout.html" id="checkoutBtn" class="checkout-link">Checkout</a>
    </div>
</div>
<div class="overlay" id="overlay"></div>

<!-- ===================== SHOP PAGE ===================== -->
<section class="shop-page">
  <div class="shop-container">
    <!-- Left Sidebar - Filters -->
    <aside class="shop-sidebar">
      <!-- Categories -->
      <div class="filter-section">
        <ul class="category-list">
          <li><a href="#" data-category="all" class="category-link active">All Products</a></li>
          <li><a href="#" data-category="iphones" class="category-link">iPhones</a></li>
          <li><a href="#" data-category="samsung" class="category-link">Samsung</a></li>
          <li><a href="#" data-category="ipads" class="category-link">iPads</a></li>
          <li><a href="#" data-category="smartwatch" class="category-link">Smart Watches</a></li>
          <li><a href="#" data-category="gaming" class="category-link">Gaming</a></li>
          <li><a href="#" data-category="laptops" class="category-link">Laptops</a></li>
        </ul>
      </div>

      <!-- Price Filter -->
      <div class="filter-section">
        <div class="price-header">
          <h3>Price</h3>
        </div>
        <div class="price-inputs">
          <input type="number" id="minPrice" placeholder="Min" class="price-input">
          <span>-</span>
          <input type="number" id="maxPrice" placeholder="Max" class="price-input">
        </div>
        <div class="price-ranges">
          <label><input type="radio" name="price" value="0-500"> Under $500</label>
          <label><input type="radio" name="price" value="500-1000"> $500 - $1000</label>
          <label><input type="radio" name="price" value="1000-1500"> $1000 - $1500</label>
          <label><input type="radio" name="price" value="1500+"> Over $1500</label>
        </div>
        <div class="price-buttons">
          <button id="clearPrice" class="price-btn save-btn">CLEAR</button>
          <button id="savePrice" class="price-btn clear-small">SAVE</button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="shop-main">
      <div class="shop-header">
        <h1>All Products</h1>
        <div class="sort-controls">
          <span>Sort by:</span>
          <select id="sortBy" class="sort-select">
            <option value="recommended">Recommended</option>
            <option value="price-low">Price: Low to High</option>
            <option value="price-high">Price: High to Low</option>
            <option value="newest">Newest</option>
          </select>
          <div class="view-toggle">
            <button id="gridView" class="view-btn active" title="Grid View">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/></svg>
            </button>
            <button id="listView" class="view-btn" title="List View">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="shop-grid grid-view" id="shopGrid">
        <!-- Products will be loaded here dynamically -->
      </div>
    </main>
  </div>
</section>

<!-- ===================== BOTTOM NAV (MOBILE) ===================== -->
<nav class="bottom-nav" id="bottomNav">
  <a href="index.html" class="bottom-nav-item" title="Shop">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6.331 8h11.339a2 2 0 0 1 1.977 2.304l-1.255 8.152a3 3 0 0 1 -2.966 2.544h-6.852a3 3 0 0 1 -2.965 -2.544l-1.255 -8.152a2 2 0 0 1 1.977 -2.304z" /><path d="M9 11v-5a3 3 0 0 1 6 0v5" /></svg>
    <span>Shop</span>
  </a>
  <a href="index.html" class="bottom-nav-item" title="Home">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7" /><path d="M9 22V12h6v10" /></svg>
    <span>Home</span>
  </a>
  <a href="#" class="bottom-nav-item" id="bottomNavWishlist" title="Wishlist">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572" /></svg>
    <span>Wishlist</span>
  </a>
  <a href="#" class="bottom-nav-item" id="bottomNavCart" title="Cart">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M17 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M17 17h-11v-14h-2" /><path d="M6 5l14 1l-1 7h-13" /></svg>
    <span>Cart</span>
  </a>
</nav>

<!-- ===================== FOOTER ===================== -->
<footer class="footer">
  <div class="footer-content-wrapper">
    <!-- Footer Main Content -->
    <div class="footer-main">
      <!-- Brand Section -->
      <div class="footer-brand">
        <div class="footer-logo-section">
          <img src="skyynettlogo.png" alt="Skyynett Logo" class="footer-logo-img">
          <div>
            <h3>Skyynett</h3>
            <p>Quality, affordable gadgets you can trust</p>
          </div>
        </div>
      </div>

      <!-- Quick Links -->
      <div class="footer-column">
        <h4>Quick Links</h4>
        <div class="footer-links-grid">
          <a href="#">Home</a>
          <a href="shop.html">Shop</a>
          <a href="categories.html">Categories</a>
          <a href="#">About Us</a>
          <a href="#">Contact</a>
          <a href="#">Blog</a>
          <a href="admin-dashboard/public/admin.html">Admin</a>
        </div>
      </div>

      <!-- Support Section -->
      <div class="footer-column">
        <h4>Support</h4>
        <div class="footer-links-grid">
          <a href="#">FAQ</a>
          <a href="#">Shipping Info</a>
          <a href="#">Privacy Policy</a>
          <a href="#">T&Cs</a>
          <a href="#">Contact Us</a>
          <a href="#">Help Center</a>
        </div>
      </div>

      <!-- Connect Section -->
      <div class="footer-column">
        <h4>Connect With Us</h4>
        <div class="footer-social-icons">
          <a href="#" id="whatsapp-icon" class="social-icon" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
          <a href="#" id="fb-icon" class="social-icon" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
          <a href="#" id="insta-icon" class="social-icon" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
          <a href="#" class="social-icon" id="twitter-icon" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
        </div>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="footer-bottom-left">
        <p>&copy; 2025 Skyynett. All rights reserved.</p>
      </div>
      <div class="footer-bottom-right">
        <button id="backToTop" class="back-to-top-btn" onclick="window.location.href='index.html'"><i class="fa-solid fa-arrow-up"></i> Back to Top</button>
      </div>
    </div>
  </div>
</footer>

<script src="search.js"></script>
<script src="cart.js"></script>
<script src="product-detail.js"></script>
<script src="script.js"></script>
<script>
  let allProducts = [];
  let filteredProducts = [];
  let currentCategory = 'all';
  let currentSort = 'recommended';
  let currentView = 'grid';

  // Fetch and display products
  async function loadShopProducts() {
    try {
      let data;
      try {
        // Try API first
        const response = await fetch('http://localhost:5000/api/products');
        const products = await response.json();
        data = { products };
      } catch (apiError) {
        // Fallback to static JSON file
        const response = await fetch('admin-dashboard/server/data/db.json');
        data = await response.json();
      }
      allProducts = data.products;
      filteredProducts = [...allProducts];
      renderProducts();
    } catch (error) {
      console.error('Error loading products:', error);
      document.getElementById('shopGrid').innerHTML = '<p>Failed to load products</p>';
    }
  }

  // Render products to grid
  function renderProducts() {
    const shopGrid = document.getElementById('shopGrid');
    shopGrid.innerHTML = '';
    
    filteredProducts.forEach(product => {
      const productCard = document.createElement('div');
      productCard.className = `product-card shop-product ${currentView === 'list' ? 'list-view' : ''}`;
      productCard.innerHTML = `
        <div class="img-box">
          <img src="${product.imageUrl}" alt="${product.title}">
          <div class="verified-badge">‚úì Verified</div>
        </div>
        <div class="product-info">
          <div class="price-tag">$${product.price}</div>
          <h3>${product.title}</h3>
          <p class="product-description">${product.description || 'Premium quality product'}</p>
          <div class="product-meta">
            <span class="location">üìç Available</span>
            <span class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5)</span>
          </div>
          <button class="add-to-cart" data-product-id="${product._id}" data-product-name="${product.title}" data-product-price="${product.price}" data-product-image="${product.imageUrl}">Add to Cart</button>
        </div>
      `;
      shopGrid.appendChild(productCard);
    });

    // Attach add-to-cart listeners
    document.querySelectorAll('.add-to-cart').forEach(btn => {
      btn.addEventListener('click', function() {
        const productName = this.dataset.productName;
        const productPrice = parseFloat(this.dataset.productPrice);
        
        // Use global addToCart from cart.js
        if (window.addToCart) {
          window.addToCart(productName, productPrice);
        }
        
        // Show feedback
        const originalText = this.textContent;
        this.textContent = 'Added!';
        this.style.background = '#27ae60';
        setTimeout(() => {
          this.textContent = originalText;
          this.style.background = '';
        }, 1500);
      });
    });

    // Attach product detail modal click listeners
    if (window.attachProductClickListeners) {
      window.attachProductClickListeners();
    }
  }

  // Filter by category
  document.querySelectorAll('.category-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      document.querySelectorAll('.category-link').forEach(l => l.classList.remove('active'));
      link.classList.add('active');
      currentCategory = link.dataset.category;
      applyFilters();
    });
  });

  // Sort products
  document.getElementById('sortBy').addEventListener('change', (e) => {
    currentSort = e.target.value;
    applySorting();
    renderProducts();
  });

  // Grid/List view toggle
  document.getElementById('gridView').addEventListener('click', () => {
    currentView = 'grid';
    document.getElementById('gridView').classList.add('active');
    document.getElementById('listView').classList.remove('active');
    document.getElementById('shopGrid').classList.remove('list-view');
    renderProducts();
  });

  document.getElementById('listView').addEventListener('click', () => {
    currentView = 'list';
    document.getElementById('listView').classList.add('active');
    document.getElementById('gridView').classList.remove('active');
    document.getElementById('shopGrid').classList.add('list-view');
    renderProducts();
  });

  // Clear filters
  document.getElementById('clearPrice').addEventListener('click', () => {
    document.getElementById('minPrice').value = '';
    document.getElementById('maxPrice').value = '';
    document.querySelectorAll('input[name="price"]').forEach(r => r.checked = false);
    applyFilters();
  });

  // Save price filter
  document.getElementById('savePrice').addEventListener('click', () => {
    applyFilters();
  });

  // when any price radio changes, re-apply filters
  document.querySelectorAll('input[name="price"]').forEach(r => r.addEventListener('change', () => applyFilters()));

  // live update when user types min/max
  document.getElementById('minPrice').addEventListener('input', () => {
    // clear any radio selection to indicate custom range
    document.querySelectorAll('input[name="price"]').forEach(r => r.checked = false);
    applyFilters();
  });
  document.getElementById('maxPrice').addEventListener('input', () => {
    document.querySelectorAll('input[name="price"]').forEach(r => r.checked = false);
    applyFilters();
  });

  // Helper: return selected price range {min, max} or null if none
  function getSelectedPriceRange() {
    const minInput = document.getElementById('minPrice').value.trim();
    const maxInput = document.getElementById('maxPrice').value.trim();
    const hasCustom = minInput !== '' || maxInput !== '';

    if (hasCustom) {
      const min = minInput !== '' ? Number(minInput) : null;
      const max = maxInput !== '' ? Number(maxInput) : null;
      return { min: isNaN(min) ? null : min, max: isNaN(max) ? null : max };
    }

    const selected = document.querySelector('input[name="price"]:checked');
    if (!selected) return null;
    const val = selected.value;
    if (val.endsWith('+')) {
      const n = Number(val.replace('+',''));
      return { min: n, max: null };
    }
    const parts = val.split('-').map(p => Number(p));
    if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
      return { min: parts[0], max: parts[1] };
    }
    return null;
  }

  // Apply filters (category + price)
  function applyFilters() {
    const range = getSelectedPriceRange();
    console.log('Applying filters, price range:', range);

    filteredProducts = allProducts.filter(product => {
      const categoryMatch = currentCategory === 'all' || (product.categoryId && product.categoryId.includes && product.categoryId.includes(currentCategory));

      if (!categoryMatch) return false;

      if (!range) return true; // no price filter selected

      const price = Number(product.price);
      if (isNaN(price)) return false;

      if (range.min !== null && range.max !== null) {
        return price >= range.min && price <= range.max;
      }
      if (range.min !== null && range.max === null) {
        return price >= range.min;
      }
      if (range.min === null && range.max !== null) {
        return price <= range.max;
      }
      return true;
    });

    applySorting();
    renderProducts();
  }

  // Apply sorting
  function applySorting() {
    switch(currentSort) {
      case 'price-low':
        filteredProducts.sort((a, b) => a.price - b.price);
        break;
      case 'price-high':
        filteredProducts.sort((a, b) => b.price - a.price);
        break;
      case 'newest':
        filteredProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        break;
      default:
        // recommended - keep original order
        break;
    }
  }

  // Load products on page load
  document.addEventListener('DOMContentLoaded', loadShopProducts);
</script>

<!-- ===================== PRODUCT DETAIL MODAL ===================== -->
<div class="product-detail-modal" id="productDetailModal">
  <div class="product-detail-content">
    <button class="close-detail" id="closeProductDetail" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </button>
    <div class="detail-image-section">
      <img id="detailProductImage" src="" alt="Product" class="detail-image">
    </div>
    <div class="detail-info-section">
      <h2 id="detailProductTitle"></h2>
      <p id="detailProductPrice" class="detail-price"></p>
      <p id="detailProductDesc" class="detail-description"></p>
      <button id="detailAddToCart" class="add-to-cart-detail">Checkout</button>
    </div>
  </div>
</div>

</body>
</html>
